<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Delegates and Events</title>
        <meta name="viewport" content="width=device-width">
        <meta name="description" content="">
        <!-- Prism syntax highlighting -->
        <link href="https://codesolid.github.io/css/prism.css" rel="stylesheet" type="text/css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="https://codesolid.github.io/css/style.css">

        <!-- Navbar only -->
        <link rel="stylesheet" href="https://codesolid.github.io/css/nav.css">
        
        <!-- <link href='http://fonts.googleapis.com/css?family=Vollkorn:400,700' rel='stylesheet' type='text/css'> -->
        <link href='http://fonts.googleapis.com/css?family=Lora:400,700' rel='stylesheet' type='text/css'>
        
    </head>

    <body>

        <div class="container">
        <header><h1><span class="logo_code">Code</span><span class="logo_solid">Solid</span></h1><p>Test Automation Specialists</p></header>
        <nav id="nav">
        <ul>
        <li><a href="/index.html">Home</a></li>        
        <li><a href="/goalboost/">Goalboost.com</a></li>
        <li><a href="/selenium/">Selenium Testing</a></li>
        <li><a href="/blog.html">Blog</a></li>
        <li><a href="/contact/">Contact Us</a></li>
        </ul>    
        </nav>

        <div class="site">        
          <h2>Delegates and Events</h2>
<p class="meta">28 Aug 2009</p>

<div class="post">
<p>In .NET, delegates are classes that implement type safe function pointers.  Like all function pointers, they can be used whereever you need dynamic execution of code.  One use of delegates that is ubiquitous in .NET is as a mechanism for handling events.  Both ASP.NET Webforms and the Windows development Winforms classes uses such delegates as event handlers.  So does our little program below, which shows how to translate keypresses into events, then handle certain events as they&#39;re raised.</p>

<p>As a side note, this was the first sample I developed using Visual Studio 2010 beta (though it compiles and runs fine under 2005 as well).</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;code&gt;
using System;

/*
 *  Since we&#39;ll be raising events, we create a simple
 *  EventArgs class that knows about System.ConsoleModifiers 
 *  (i.e. keyboard states like CTRL, ALT, SHIFT)
 */
public class KeyEventArgs : EventArgs
{
    private ConsoleModifiers _cm;

    public KeyEventArgs(ConsoleModifiers cm)
    {
        _cm = cm;
    }
    public ConsoleModifiers Modifiers
    {
        get { return _cm; }
    }
}

/*
 * Define an event delegate.  Our publisher defines instances
 * of this delegate.  Our subscribers add event handlers to the 
 * publisher&#39;s delegates for the events they&#39;re interested in.
 */
public delegate void KeyEventDelegate(object obj, KeyEventArgs e);

/* 
 * A simple event publisher.  Translate keypresses into events that
 * a subscriber can subscribe to.
 * */
class KeyPublisher
{
    // Translate keypresses into events
    public void KeypressToEvent(ConsoleKeyInfo pressed)
    {
        // No event generated for a plain old key
        Console.WriteLine(&quot;Pressed:  {0}&quot;, pressed.KeyChar);

        // Now the plot thickens
        if (pressed.Modifiers != 0)
        {
            KeyEventArgs kea = new KeyEventArgs(pressed.Modifiers);

            // Alt key pressed?
            if ((pressed.Modifiers &amp; ConsoleModifiers.Alt) != 0)
            {
                // I.e., if someone has subscribed
                if (AltKeyPressed != null)
                {
                    // Raise an event
                    AltKeyPressed(this, kea);
                }
            }

            // Etc...
            if ((pressed.Modifiers &amp; ConsoleModifiers.Control) != 0)
            {
                if (ControlKeyPressed != null) 
                    ControlKeyPressed(this, kea);
            }

            if ((pressed.Modifiers &amp; ConsoleModifiers.Shift) != 0)
            {
                if (ShiftKeyPressed != null)
                    ShiftKeyPressed(this, kea);
            }
        }

    }

    public static event KeyEventDelegate AltKeyPressed = null;
    public static event KeyEventDelegate ShiftKeyPressed = null;
    public static event KeyEventDelegate ControlKeyPressed = null;
}

/*
 * Create some simple event hanlders we can use.  We&#39;ll wire these
 * up below in our sample &quot;Main&quot;
 */
class KeySubscriber
{
    // Function signature matches our delegate
    public void HandleControlKey(Object ojb, KeyEventArgs e)
    {
        Console.WriteLine(&quot;Control key pressed&quot;);
    }

    // Function signature matches our delegate
    public void HandleAltKey(Object ojb, KeyEventArgs e)
    {
        Console.WriteLine(&quot;Alt key pressed&quot;);
    }   

    // But I&#39;m not interested in Shift keys
}


class EventHandlerExample
{
    static void Main(string[] args)
    {
        // Create a publisher to fire events
        KeyPublisher pub = new KeyPublisher();

        // Create a subscriber to respond to them
        KeySubscriber sub = new KeySubscriber();

        // Link event handlers to events
        KeyPublisher.AltKeyPressed += sub.HandleAltKey;
        KeyPublisher.ControlKeyPressed += sub.HandleControlKey;

        // Read keys and translate to events
        ConsoleKeyInfo keyInfo;
        bool finished = false;
        while (! finished)
        {
            keyInfo = Console.ReadKey();
            switch (keyInfo.KeyChar)
            {
                case &#39;Q&#39;:
                case &#39;q&#39;:
                    finished = true;
                    break;

                default:
                    // Publish!
                    pub.KeypressToEvent(keyInfo);
                    break;
            }
        }

    }
}


&lt;/code&gt;
</code></pre></div>
<p>Output of course varies depending on what keys you press. One possibility:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">&lt;code&gt;
aPressed:  a
bPressed:  b
☻Pressed:  ☻
Control key pressed
◄Pressed:  ◄
Control key pressed
♦Pressed:  ♦
Control key pressed
aPressed:  a
Alt key pressed
 Pressed:
Alt key pressed
Control key pressed
&lt;/code&gt;
</code></pre></div>
</div>

<!--
          <div class="footer">
            <div class="contact">
              <p>
                Your Name<br />
                What You Are<br />
                you@example.com
              </p>
              
            </div>
            <div class="contact">

              <p>
                <a href="https://github.com/yourusername">github.com/yourusername</a><br />
                <a href="https://twitter.com/yourusername">twitter.com/yourusername</a><br />
              </p>
            </div>
-->
          </div>

    <script src="/js/prism.js"></script>
    </div>
    </div>
    </body>
</html>
